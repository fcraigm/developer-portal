---
title: How to Ensure Authorization
---

If the extension interacts with the mStudio API on behalf of a mStudio user, this may lead to insufficient permissions.
An extension acts on behalf of a mStudio user, if it uses the [access token retrieval key](../../overview/concepts/authentication#access-token-retrieval-key)
or [OAuth2](../../overview/concepts/authentication#oauth2) for the authentication.

The mStudio ensures that a mStudio user never has more permissions using an extension than they have using the mStudio directly.
Additionally, it ensures that a mStudio user using an extension only has the permissions they accepted when installing the extension.

However, it does not ensure that the mStudio user using an extension has all the permissions required for executing the domain actions necessary for the extension.
This is due to the system of rights and roles of the mStudio that defines different roles for organizations and projects.
Therefore, an extension may execute a domain action the user is not permitted to perform.
This leads to an error message.

So for example, if an extension should create projects via the [project-create-project](../../../reference/project/project-create-project) operation
and the user only has the role "Organization accountant", they will encounter an error message when using the extension because the role does not permit creating projects.


```mermaid
sequenceDiagram
  participant User as mStudio User
  participant Extension
  participant mStudio

  User->>Extension: Open
  Extension-->>User: 200 OK
  User->>Extension: Navigate to Feature foo
  Extension-->>User: 200 OK
  User->>Extension: Use Feature foo
  Extension->>mStudio: Domain Action foo
  mStudio-->>Extension: 403 Forbidden
  Extension-->>User: 403 Forbidden
```

The extension should validate the required permissions in advance to provide a good user experience.
For this, it can use the operations [project-get-project-membership](../../../reference/project/project-get-project-membership) or [customer-get-customer-membership](../../../reference/customer/customer-get-customer-membership).

Those routes return the current membership to an extension context of the user.
This contains the roles of the user in that context, among other things.


By validating the user's role, the extension can display a warning to the user, that they do not have the required permissions to execute the domain action and should contact the context administrator to get the missing permissions.

```mermaid
sequenceDiagram
  participant User as mStudio User
  participant Extension
  participant mStudio

  User->>Extension: Open
  Extension->>mStudio: project-get-project-membership
  mStudio-->>Extension: Organisation accountant
  Extension-->>User: Warning regarding missing permissions
```

Dem Contributor bleibt dabei die Flexibilität, ob er die Extension für mStudio Benutzer mit eingeschränkten Rechten vollständig sperrt, wie im Beispiel oben,
oder nur für die entsprechenden Features.

```mermaid
sequenceDiagram
  participant User as mStudio Benutzer
  participant Extension
  participant mStudio

  User->>Extension: Öffnen
  Extension-->>User: 200 OK
  User->>Extension: Navigiere zu Feature foo
  Extension->>mStudio: project-get-project-membership
  mStudio-->>Extension: Organisationsbuchhalter
  Extension-->>User: Hinweis auf fehlende Berechtigung
  User->>Extension: Navigiere zu Feature bar
  Extension->>mStudio: project-get-project-membership
  mStudio-->>Extension: Organisationsbuchhalter
  Extension-->>User: 200 OK
  User->>Extension: Nutze Feature bar
  Extension->>mStudio: Domain Action bar
  mStudio-->>Extension: 200 OK
  Extension-->>User: 200 OK
```
Rein technisch stellt es eine Alternative dar, die Domain Actions im Namen der Extension auszuführen.
Dafür muss die Extension das [Extension Instance Secret](../../overview/concepts/authentication#extension-instance-secret) verwenden,
um ein Access Token zu beziehen.
In diesem Fall wird die Domain Action mit den Rechten der Extension ausgeführt.
Dies hat jedoch den Nachteil, dass Organisationsinhaber und Project Administratoren nicht mehr über die Vergabe von Rollen steuern können,
welche Benutzer welche Domain Actions ausführen dürfen, was eine Sicherheitslücke darstellen
und zu einer Verschlechterung der User-Experience führen kann.


