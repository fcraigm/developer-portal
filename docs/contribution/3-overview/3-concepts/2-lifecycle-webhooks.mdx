---
title: Lifecycle Webhooks
---

## What are Lifecycle Webhooks?

mittwald uses lifecycle webhooks to inform the external application of events relevant to that application.
The extension defines the endpoints mittwald uses to send lifecycle updates in its configuration.
The lifecycle updates are sent via a POST request.

Optionally, you can use different placeholders in the URLs used for the lifecycle webhooks.
For more information on templating, see [templating of configuration values](../templating).
For an overview of the possible placeholders available in lifecycle webhook URL templates, see [templating of webhook URLs](../../../reference/webhooks#templating-of-webhook-urls).

## Quality of Service (QoS) for the Delivery of Lifecycle Webhooks

The mStudio executes all webhook calls `at least once`.
Therefore, you must design the webhook endpoints so that multiple calls do not result in errors.
The webhook calls are executed asynchronously to the action that triggered them.
If a webhook call fails, the webhook payload is rebuilt.
The request is then signed and resubmitted.
These retries are delayed with a capped exponential backoff to limit the number of requests.

The mStudio will retry a webhook call until it receives a response that the extension processed the call successfully.
It also ensures that the webhooks are in the correct order per **extension instance**.
The only exception to this rule is the removal of extensions from a context.
In that case, the mStudio aborts all inactive or pending webhook calls.
Only the `ExtensionInstanceRemovedFromContext` webhook call is executed and retried until the extension processed the call successfully or the extension is from the marketplace.

:::caution
If the mStudio backend does not receive a response from the extension webhook handler **within 6 seconds**, it interprets this as a **timeout**, and the webhook call execution fails.
The mStudio retries the delivery of the webhook in this case as well.
Therefore, you must ensure to design webhook call handlers to be idempotent.
This avoids errors in scenarios where your webhook handler successfully processes a webhook call, but the response is not delivered to the mStudio backend in time.

In addition, we recommend that you do not **synchronously execute complex computations or processes** that could cause the webhook call processing to exceed the 6-second limit.

If the extension runs in a **cloud environment**, you should ensure not to **completely scale down** the webhook call handler.
This leads to cold starts, which are included in the processing time from the perspective of the mStudio.
:::

## Secrets in Webhooks

The secrets that the mStudio communicates via webhook calls are valid as soon as the webhook call is processed successfully.
You should expect an additional indefinite delay of less than a few seconds until the secret is valid.
This is an additional reason to start initializing processes triggered by webhooks asynchronously and only process and store the transmitted data in the webhook handler.

For more information about how to use the extension instance secret, see [authentication](../authentication#extension-instance-secret).

## Primary Key / Identifier of Extension Instances

Every extension instance gets a unique extension instance ID.
If you want to persist extension instances, you **should use the extension instance ID as the primary key or unique identifier** instead of the context ID.
The following dangerous scenario that can occur due to the asynchronous nature of the webhook call executions is the reason for this recommendation.
An extension is removed from a context and immediately added to the same context (for example, to start again with a clean configuration).
If the `ExtensionInstanceAddedToContext`-webhook call of the new extension instance is processed before the `ExtensionInstanceRemovedFromContext` webhook of the old instance,
this may lead to the deletion of all extension instances of that context.
This includes the newly created extension instance that should exist.

## Validation of Webhook Data

We do not recommend validating the data communicated by webhook calls and rejecting them in case of a validation error if this is not necessary for the execution of your extension.
You should always see the mStudio as the single source of truth.
If the format of extension instance IDs changes, for example, we will document and announce this.
If you miss this information, the extension instance ID format validation presents an unnecessary risk.

## Typen von Lifecycle Webhooks

### ExtensionAddedToContext

Dieses Event dient dazu, externen Anwendungen mitzuteilen, dass die Extension zu einem neuen Kontext hinzugefügt wurde.
Im Rahmen dieses Prozesses werden die Extension Instance ID und das Extension Instance Secret erstmalig übermittelt.

Das Extension Instance Secret kann nicht im Handler selbst direkt verwendet werden.
Siehe dazu auch [Secrets in Webhooks](#secrets-in-webhooks).

### ExtensionInstanceUpdated

In diesem Event wird der externen Anwendung eine Zustandsänderung der `Extension Instance` mitgeteilt.
Der externen Anwendung wird dabei immer der gesamte neue Zustand mitgeteilt.

Das kann beispielsweise die De-/Aktivierung der `Extension Instance` sein.

### ExtensionInstanceSecretRotated

Aus Sicherheitsgründen wird das Extension Instance Secret regelmäßig rotiert.
Das neue Secret wird über diesen Webhook mitgeteilt.
Das vorherige Secret ist ab diesem Zeitpunkt nicht mehr gültig.
Analog zum [ExtensionAddedToContext](#extensionaddedtocontext)-Webhook kann auch hier das Secret nicht direkt im Handler verwendet werden.
Siehe dazu auch [Secrets in Webhooks](#secrets-in-webhooks).

### ExtensionInstanceRemovedFromContext

Dieser Webhook drückt aus, dass eine `Extension Instance` aus einem Context entfernt wurde.
Datenschutzrelevante Konsequenzen, wie die Löschung von personenbezogenen Daten, sollten an dieser Stelle berücksichtigt werden.

:::note
Für den `ExtensionInstanceRemovedFromContext`-Webhook wird eine spezielle Behandlung hinsichtlich der QoS vorgenommen.
Falls die Webhook Handler nicht erreichbar sind, besteht die Möglichkeit, das Entfernen der Extension zu forcieren.
In diesem Fall werden die Rechte der Extension Instance entzogen und bestehende Access Tokens invalidiert.

Das mStudio versucht dennoch weiterhin, den Webhook zu versenden,
um schlussendlich einen konsistenten Zustand zwischen mStudio- und Extension Datenbestand zu erreichen.
:::

## Verifizierung der Sender-Identität von Webhooks

Um sicherzustellen, dass der Webhook von mittwald ausging, wird die Möglichkeit geboten, die Identität des Senders und den Inhalt des Request Bodys zu verifizieren.
Neben dem Request Body, der den Webhook Payload enthält, wird in Request Headern eine Signatur inklusive der Meta-Informationen über diese versendet.

Dies ist aus Sicht des Contributors und der Extension wichtig, da somit sichergestellt werden kann, dass der Webhook-Call wirklich von mittwald stammt.
Ohne eine funktionierende Webhook Validierung besteht das Risiko, dass ein potenzieller Angreifer nur die URL kennen muss, um falsche Extension Instances vorzutäuschen oder bestehende zu korrumpieren.
Für weitere Informationen dazu, wie Webhooks auf ihre Echtheit überprüft werden können, siehe [Validierung von Lifecycle Webhooks Referenz](../../../reference/webhooks#validierung-von-lifecycle-webhooks).
