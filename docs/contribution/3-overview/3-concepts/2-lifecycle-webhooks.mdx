---
title: Lifecycle Webhooks
---

## What are Lifecycle Webhooks?

mittwald uses lifecycle webhooks to inform the external application of events relevant to that application.
The extension defines the endpoints mittwald uses to send lifecycle updates in its configuration.
The lifecycle updates are sent via a POST request.

Optionally, you can use different placeholders in the URLs used for the lifecycle webhooks.
For more information on templating, see [templating of configuration values](../templating).
For an overview of the possible placeholders available in lifecycle webhook URL templates, see [templating of webhook URLs](../../../reference/webhooks#templating-of-webhook-urls).

## Quality of Service (QoS) for the Delivery of Lifecycle Webhooks

The mStudio executes all webhook calls `at least once`.
Therefore, you must design the webhook endpoints so that multiple calls do not result in errors.
The webhook calls are executed asynchronously to the action that triggered them.
If a webhook call fails, the webhook payload is rebuilt.
The request is then signed and resubmitted.
These retries are delayed with a capped exponential backoff to limit the number of requests.

The mStudio will retry a webhook call until it receives a response that the extension processed the call successfully.
It also ensures that the webhooks are in the correct order per **extension instance**.
The only exception to this rule is the removal of extensions from a context.
In that case, the mStudio aborts all inactive or pending webhook calls.
Only the `ExtensionInstanceRemovedFromContext` webhook call is executed and retried until the extension processed the call successfully or the extension is from the marketplace.

:::caution
If the mStudio backend does not receive a response from the extension webhook handler **within 6 seconds**, it interprets this as a **timeout**, and the webhook call execution fails.
The mStudio retries the delivery of the webhook in this case as well.
Therefore, you must ensure to design webhook call handlers to be idempotent.
This avoids errors in scenarios where your webhook handler successfully processes a webhook call, but the response is not delivered to the mStudio backend in time.

In addition, we recommend that you do not **synchronously execute complex computations or processes** that could cause the webhook call processing to exceed the 6-second limit.

If the extension runs in a **cloud environment**, you should ensure not to **completely scale down** the webhook call handler.
This leads to cold starts, which are included in the processing time from the perspective of the mStudio.
:::

## Secrets in Webhooks

Secrets, die in Webhooks übermittelt werden, sind erst gültig, wenn der Webhook erfolgreich verarbeitet wurde.
Danach sollte zusätzlich mit einer undefinierbaren Verzögerung, maximal im Sekundenbereich, gerechnet werden, bis das Secret schlussendlich gültig ist.
Dies stellt einen weiteren Grund dar, Initialisierungsprozesse, die durch Webhooks ausgelöst werden, nachgelagert zu starten
und im Webhook Handler hauptsächlich die Verarbeitung der Daten zu übernehmen.

Für weitere Informationen dazu, wie das Extension Instance Secret verwendet werden kann, siehe [Authentifizierung](../authentication#extension-instance-secret).

## Primary Key / Identifier von Extension Instances

Jede Extension Instance erhält systembedingt eine eigene Extension Instance ID.
Wenn Extension Instances von einer Extension persistiert werden sollen,
**sollte diese ID als Primary Key oder Unique Identifier verwendet werden** und nicht die Context ID.
Der Grund dafür ist, dass die Webhooks asynchron ausgeführt werden.
Ein gefährliches Szenario für die Context ID als Primary Key stellt sich wie folgt dar:
Eine Extension wird von einem Context entfernt und anschließend direkt wieder hinzugefügt (bspw. um mit frischer Konfiguration erneut zu starten).
Wenn der `ExtensionInstanceAddedToContext`-Webhook der neuen Extension Instance vor dem `ExtensionInstanceRemovedFromContext`-Webhook der alten Extension Instance verarbeitet wird,
könnte es dazu führen, dass alle Extension Instances des Context gelöscht wurden, obwohl eigentlich eine Extension Instance für diesen Context existieren sollte.

## Validierung von Webhook Daten

Es wird nicht empfohlen, Webhooks aufgrund von Validierungs-Fehlern von Daten abzulehnen, die nicht zwingend für den Programmablauf der Extension benötigt werden.
Das mStudio sollte stets als Single Source of Truth betrachtet werden.
Wenn bspw. das Format von Extension Instance IDs geändert wird, dann wird dies dokumentiert und angekündigt.
Wenn diese Information jedoch übersehen wird, wird mit der Validierung des Formats der Extension Instance ID ein unnötiges Risiko eingegangen.

## Typen von Lifecycle Webhooks

### ExtensionAddedToContext

Dieses Event dient dazu, externen Anwendungen mitzuteilen, dass die Extension zu einem neuen Kontext hinzugefügt wurde.
Im Rahmen dieses Prozesses werden die Extension Instance ID und das Extension Instance Secret erstmalig übermittelt.

Das Extension Instance Secret kann nicht im Handler selbst direkt verwendet werden.
Siehe dazu auch [Secrets in Webhooks](#secrets-in-webhooks).

### ExtensionInstanceUpdated

In diesem Event wird der externen Anwendung eine Zustandsänderung der `Extension Instance` mitgeteilt.
Der externen Anwendung wird dabei immer der gesamte neue Zustand mitgeteilt.

Das kann beispielsweise die De-/Aktivierung der `Extension Instance` sein.

### ExtensionInstanceSecretRotated

Aus Sicherheitsgründen wird das Extension Instance Secret regelmäßig rotiert.
Das neue Secret wird über diesen Webhook mitgeteilt.
Das vorherige Secret ist ab diesem Zeitpunkt nicht mehr gültig.
Analog zum [ExtensionAddedToContext](#extensionaddedtocontext)-Webhook kann auch hier das Secret nicht direkt im Handler verwendet werden.
Siehe dazu auch [Secrets in Webhooks](#secrets-in-webhooks).

### ExtensionInstanceRemovedFromContext

Dieser Webhook drückt aus, dass eine `Extension Instance` aus einem Context entfernt wurde.
Datenschutzrelevante Konsequenzen, wie die Löschung von personenbezogenen Daten, sollten an dieser Stelle berücksichtigt werden.

:::note
Für den `ExtensionInstanceRemovedFromContext`-Webhook wird eine spezielle Behandlung hinsichtlich der QoS vorgenommen.
Falls die Webhook Handler nicht erreichbar sind, besteht die Möglichkeit, das Entfernen der Extension zu forcieren.
In diesem Fall werden die Rechte der Extension Instance entzogen und bestehende Access Tokens invalidiert.

Das mStudio versucht dennoch weiterhin, den Webhook zu versenden,
um schlussendlich einen konsistenten Zustand zwischen mStudio- und Extension Datenbestand zu erreichen.
:::

## Verifizierung der Sender-Identität von Webhooks

Um sicherzustellen, dass der Webhook von mittwald ausging, wird die Möglichkeit geboten, die Identität des Senders und den Inhalt des Request Bodys zu verifizieren.
Neben dem Request Body, der den Webhook Payload enthält, wird in Request Headern eine Signatur inklusive der Meta-Informationen über diese versendet.

Dies ist aus Sicht des Contributors und der Extension wichtig, da somit sichergestellt werden kann, dass der Webhook-Call wirklich von mittwald stammt.
Ohne eine funktionierende Webhook Validierung besteht das Risiko, dass ein potenzieller Angreifer nur die URL kennen muss, um falsche Extension Instances vorzutäuschen oder bestehende zu korrumpieren.
Für weitere Informationen dazu, wie Webhooks auf ihre Echtheit überprüft werden können, siehe [Validierung von Lifecycle Webhooks Referenz](../../../reference/webhooks#validierung-von-lifecycle-webhooks).
