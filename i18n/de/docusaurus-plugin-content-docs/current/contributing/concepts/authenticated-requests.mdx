# Authentication Flows

## OAuth 2.0

mittwald unterstützt OAuth 2.0 als Authentifizierungsmechanismus für die öffentliche API. Dieser Mechanismus ist in der [RFC 6749](https://tools.ietf.org/html/rfc6749) spezifiziert. Unterstützt werden die folgenden OAuth 2.0 Flows:

- Authorization Code Grant
- Authorization Code Grant with PKCE
- Implicit Grant

## Single Sign On (SSO)

Um mStudio Benutzern einen bequemen Einstieg in die externe Anwendung zu ermöglichen, bietet das mStudio einen SSO Mechanismus an. Per Knopfdruck im mStudio wird der Benutzer zur externen Anwendung weitergeleitet und ist authentifiziert.

Dazu generiert das mStudio einen Access Token Retrieval Key und übermittelt diesen beim Click an die externe Anwendung. Sie kann diesen verwenden, um ein Access Token für das mStudio zu beziehen. Dieses Access Token kann anschließend verwendet werden, um Domain Actions auszuführen.

# Ausführen von authentifizierten Domain Actions ...

## ... als mStudio-Benutzer durch eine externe Anwendung

Um einen mStudio-Benutzer im Context einer externen Anwendung zu authentifizieren, sind zwei Möglichkeiten vorgesehen.

Erstens kannst du als Contributor eine URL (oder ein URL-Template) für die Extension bereitstellen, die der Benutzer über eine Schaltfläche im mStudio aufrufen kann, um zur externen Anwendung weitergeleitet zu werden. Während der Weiterleitung stellen wir einen Access Token Retrieval Key als Query-Parameter bereit. Die externe Anwendung kann diesen verwenden, um das eigentliche Access Token zum Authentifizieren gegen die öffentliche API abzurufen.

Zweitens kann die externe Anwendung den mStudio OAuth2-Authentifizierungsablauf verwenden. Weitere Details dazu werden in Zukunft bereitgestellt, da dies noch nicht vollständig ausgearbeitet ist.

Das direkte Abfragen der mStudio-Anmeldeinformationen ist keine Methode, die wir akzeptieren, da wir dem Benutzer nicht beibringen möchten, seine Anmeldeinformationen an eine Drittanbieteranwendung weiterzugeben.

Nach erfolgreicher Authentifizierung kann der mStudio-Benutzer Domain Actions ausführen. Beachte, dass dies aufgrund von CORS-Einschränkungen derzeit nur über ein externes _Backend_ möglich ist. Außerdem ist zu beachten, dass der Benutzer in diesem Anwendungsfall mit exakt den gleichen Rechten wie im mStudio - also als der Benutzer selbst - auftritt.

## ... als autonom agierende externe Anwendung

Die Durchführung einer Domain Action als externe Anwendung ohne Benutzerkontext ist der Hauptanwendungsfall für Extensions, die Funktionen bereitstellen, die nicht direkt mit der manuellen Interaktion eines Users verknüpft sind. Zu diesem Zweck kann das zuvor über das entsprechende Lebenszyklus-Ereignis mitgeteilte Secret verwendet werden, um ein Extension Access Token abzurufen. Dieses Access Token kann verwendet werden, um Domain Actions auszuführen.

## ... als externe Anwendung mit eigener Nutzerverwaltung

Analog zur zuvor beschriebenen Methode kann der gleiche Prozess verwendet werden, um eine eigene Nutzerverwaltung bereitzustellen. Nutzer, die von der externen Anwendung registriert werden, kommunizieren alle im Namen der Extension-Instance und teilen sich unterliegend dasselbe Extension Secret.

## ... als mStudio-Benutzer im Namen einer Extension-Instance

Um Domain Actions als registrierter mStudio-Benutzer, aber im Namen und nur mit Berechtigungen einer Extension-Instance durchzuführen, benötigt der Benutzer ein gültiges User-Access-Token (für Externe Anwendungen siehe oben) und die spezifische Extension-Instance ID. Mit diesen Parametern kann der Benutzer Domain Actions ausführen. Dabei stellt mittwald sicher, dass nicht nur die Extension-Instance, sondern auch der Benutzer selbst zur Ausführung der Domain Action berechtigt ist und Zugriff auf die Extension-Instance hat.

Dieser Ablauf ist interessant für Externe Anwendungen, die eine Mischung aus den vorherigen Ansätzen darstellen (z.B. um ein Admin-Panel für mStudio-Benutzer und ein Benutzer-Panel für extension-seitig verwaltete Endkunden zu implementieren).
